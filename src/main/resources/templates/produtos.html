<!DOCTYPE html>
<html data-bs-theme="light" lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Table - Life in Art</title>
    <link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora&amp;display=swap">
    <link rel="stylesheet" href="/assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="/assets/css/bs-theme-overrides.css">
</head>
<body id="page-top">
<div id="wrapper">
    <!-- Sidebar -->
    <nav class="navbar bg-primary bg-gradient align-items-start sidebar sidebar-dark accordion bg-gradient-primary p-0 navbar-dark">
        <div class="container-fluid d-flex flex-column p-0">
            <a class="navbar-brand d-flex justify-content-center align-items-center sidebar-brand m-0" href="#">
                <div class="sidebar-brand-icon rotate-n-15">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -32 576 576" width="1em" height="1em" fill="currentColor" style="font-size: 20px;">
                        <path d="M339.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L568.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S517.7-4.4 499.1 9.6L262.4 187.2c-24 18-38.2 46.1-38.4 76.1L339.3 367.1zm-19.6 25.4l-116-104.4C143.9 290.3 96 339.6 96 400c0 3.9 .2 7.8 .6 11.6C98.4 429.1 86.4 448 68.8 448H64c-17.7 0-32 14.3-32 32s14.3 32 32 32H208c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"></path>
                    </svg>
                </div>
                <div class="sidebar-brand-text mx-3"><span>Life in Art</span></div>
            </a>
            <hr class="sidebar-divider my-0">
            <ul class="navbar-nav text-light" id="accordionSidebar">
                <li class="nav-item"><a class="nav-link" href="users"><i class="far fa-user"></i><span>Usuários</span></a></li>
                <li class="nav-item"><a class="nav-link active" href="products"><i class="fas fa-box"></i><span>Produtos</span></a></li>
                <li class="nav-item"><a class="nav-link" href="pedidos.html"><i class="fas fa-table"></i><span>Pedidos</span></a></li>
            </ul>
            <div class="text-center d-none d-md-inline">
                <button class="btn rounded-circle border-0" id="sidebarToggle" type="button"></button>
            </div>
        </div>
    </nav>
    <!-- Fim Sidebar -->

    <div class="d-flex flex-column" id="content-wrapper">
        <div id="content">
            <!-- Topbar -->
            <nav class="navbar navbar-expand bg-white shadow mb-4 topbar">
                <div class="container-fluid">
                    <ul class="navbar-nav flex-nowrap ms-auto">
                        <li class="nav-item dropdown d-sm-none no-arrow">
                            <a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#">
                                <i class="fas fa-search"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end p-3 animated--grow-in">
                                <form class="me-auto navbar-search w-100">
                                    <div class="input-group">
                                        <input class="bg-light border-0 form-control small" type="text" placeholder="Pesquisar...">
                                        <button class="btn btn-primary" type="button">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </li>
                        <li class="nav-item dropdown no-arrow">
                            <div class="nav-item dropdown no-arrow">
                                <a class="dropdown-toggle nav-link" aria-expanded="false" data-bs-toggle="dropdown" href="#">
                                    <span class="d-none d-lg-inline me-2 text-gray-600 small">Usuario logado</span>
                                </a>
                                <div class="dropdown-menu shadow dropdown-menu-end animated--grow-in">
                                    <a class="dropdown-item" href="#"><i class="fas fa-user fa-sm fa-fw me-2 text-gray-400"></i>Perfil</a>
                                    <a class="dropdown-item" href="#"><i class="fas fa-cogs fa-sm fa-fw me-2 text-gray-400"></i>Configurações</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>Logout</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- Fim Topbar -->

            <div class="container-fluid">
                <h3 class="text-dark mb-4">Produtos</h3>
                <div class="card shadow">
                    <div class="card-header py-3">
                        <p class="text-primary m-0 fw-bold">Informações de produtos</p>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <button class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#modal-cadastrar-produto">
                                    Novo produto
                                </button>
                            </div>
                            <div class="col-md-6 text-end">
                                <!-- Campo de pesquisa com ID para facilitar o script -->
                                <input type="search" id="searchInput" class="form-control form-control-sm" placeholder="Pesquisar">
                            </div>
                        </div>

                        <!-- Tabela de Produtos -->
                        <div class="table-responsive" style="overflow: visible">
                            <table class="table table-bordered" id="dataTable">
                                <thead>
                                <tr>
                                    <th style="width: 100px;">Código</th>
                                    <th>Nome</th>
                                    <th style="width: 120px;">Quantidade</th>
                                    <th style="width: 120px;">Valor</th>
                                    <th style="width: 120px;">Status</th>
                                    <th style="width: 120px;">Ação</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Iteração dos produtos via Thymeleaf -->
                                <tr th:each="product : ${products}">
                                    <td th:text="${product.id}">Código</td>
                                    <td th:text="${product.name}">Nome</td>
                                    <td th:text="${product.stockQuantity}">Qtd</td>
                                    <td th:text="${product.price}">Valor</td>
                                    <td class="status-cell" th:text="${product.status} ? 'Habilitado' : 'Desabilitado'">Status</td>
                                    <td style="padding-bottom: 0px;padding-top: 0px">
                                        <div class="dropdown" style="padding: 8px">
                                            <button class="btn btn-primary dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button" style="overflow: visible">
                                                Ação
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item visualizar-produto" href="#">Visualizar</a>
                                                <a class="dropdown-item alterar-produto" href="#">Alterar</a>
                                                <a class="dropdown-item toggle-status" href="#" th:attr="data-id=${product.id}">Hab/des</a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td><strong>Código</strong></td>
                                    <td><strong>Nome</strong></td>
                                    <td><strong>Quantidade</strong></td>
                                    <td><strong>Valor</strong></td>
                                    <td><strong>Status</strong></td>
                                    <td><strong>Ação</strong></td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>

                        <!-- Paginação (exemplo estático) -->
                        <div class="row mt-3">
                            <div class="col-md-6"></div>
                            <div class="col-md-6">
                                <nav class="d-flex justify-content-end">
                                    <ul class="pagination">
                                        <li class="page-item disabled"><a class="page-link" href="#" aria-label="Previous">«</a></li>
                                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                        <li class="page-item"><a class="page-link" href="#" aria-label="Next">»</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="bg-white sticky-footer">
            <div class="container my-auto">
                <div class="text-center my-auto copyright">
                    <span>Copyright © Life in Art 2025</span>
                </div>
            </div>
        </footer>
    </div>
    <a class="border rounded d-inline scroll-to-top" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>
</div>

<!-- Modal para Cadastrar/Editar Produto -->
<div class="modal fade modal-xl" id="modal-cadastrar-produto" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Cadastrar produto</h4>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="/products" method="post" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-xxl-7">
                            <div class="mb-3">
                                <label class="form-label" for="nome-produto">Nome do produto:</label>
                                <input class="form-control" type="text" id="nome-produto" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="preco-produto">Preço:</label>
                                <input class="form-control" type="text" id="preco-produto" name="price" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="quantidade-produto">Quantidade em estoque:</label>
                                <input class="form-control" type="text" id="quantidade-produto" name="stockQuantity" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="descricao-produto">Descrição:</label>
                                <textarea class="form-control" id="descricao-produto" name="description" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="avaliacao-produto">Avaliação:</label>
                                <select class="form-select" id="avaliacao-produto" name="rating">
                                    <option value="1" selected>1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="imagens-produto">Adicionar imagens</label>
                                <input class="form-control" type="file" id="imagens-produto" name="image" multiple>
                            </div>
                        </div>
                        <div class="col-xxl-5 text-center">
                            <!-- Carrossel para pré-visualização -->
                            <div id="carousel-1" class="carousel slide" data-bs-ride="false">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img class="object-fit-cover w-100 d-block" src="https://cdn.bootstrapstudio.io/placeholders/1400x800.png" alt="Slide Image" width="433" height="500">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#carousel-1" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carousel-1" data-bs-slide="next">
                                    <span class="carousel-control-next-icon"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                                <div class="carousel-indicators">
                                    <button type="button" data-bs-target="#carousel-1" data-bs-slide-to="0" class="active"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-light" type="button" data-bs-dismiss="modal">Fechar</button>
                        <button class="btn btn-primary" type="submit">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Visualizar Detalhes do Produto -->
<div class="modal fade modal-xl" id="modal-mostrar-produto" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Detalhes do produto</h4>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card">
                    <div class="card-body">
                        <!-- Dados do produto a serem carregados dinamicamente -->
                        <div class="row">
                            <div class="col-xxl-7">
                                <div class="mb-3">
                                    <label class="form-label">Nome do produto:</label>
                                    <div class="row">
                                        <div class="col">
                                            <label class="col-form-label" id="produto-nome">Nome aqui</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Preço:</label>
                                    <div class="col">
                                        <label class="col-form-label" id="produto-preco">Preço aqui</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Quantidade em estoque:</label>
                                    <div class="col">
                                        <label class="col-form-label" id="produto-quantidade">Qtd aqui</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Descrição:</label>
                                    <div class="col">
                                        <label class="col-form-label" id="produto-descricao">Descrição aqui</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Avaliação:</label>
                                    <div class="row">
                                        <div class="col" id="produto-avaliacao">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -32 576 576" width="1em" height="1em" fill="currentColor">
                                                <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xxl-5 text-center">
                                <!-- Carrossel para exibir imagens do produto -->
                                <div id="carousel-2" class="carousel slide" data-bs-ride="false">
                                    <div class="carousel-inner">
                                        <div class="carousel-item active">
                                            <img class="w-100 d-block" src="https://cdn.bootstrapstudio.io/placeholders/1400x800.png" alt="Slide Image">
                                        </div>
                                    </div>
                                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel-2" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon"></span>
                                        <span class="visually-hidden">Previous</span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#carousel-2" data-bs-slide="next">
                                        <span class="carousel-control-next-icon"></span>
                                        <span class="visually-hidden">Next</span>
                                    </button>
                                    <div class="carousel-indicators">
                                        <button type="button" data-bs-target="#carousel-2" data-bs-slide-to="0" class="active"></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação -->
<div class="modal fade" id="modal-confirma" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Atenção</h4>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Você tem certeza que deseja fazer isso?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Não</button>
                <button class="btn btn-primary" type="button">Sim</button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts do Bootstrap -->
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="/assets/js/bs-init.js"></script>
<script src="/assets/js/theme.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Pesquisa na tabela
        var searchInput = document.getElementById("searchInput");
        if (searchInput) {
            searchInput.addEventListener("input", function() {
                var filter = searchInput.value.toLowerCase();
                var rows = document.querySelectorAll("#dataTable tbody tr");
                rows.forEach(function(row) {
                    row.style.display = row.textContent.toLowerCase().includes(filter) ? "" : "none";
                });
            });
        }

        // Atualiza carrossel de imagens ao selecionar arquivos
        var fileInput = document.getElementById("imagens-produto");
        if (fileInput) {
            fileInput.addEventListener("change", function() {
                var carouselInner = document.querySelector("#carousel-1 .carousel-inner");
                var carouselIndicators = document.querySelector("#carousel-1 .carousel-indicators");
                // Limpa itens atuais
                carouselInner.innerHTML = "";
                carouselIndicators.innerHTML = "";

                var files = fileInput.files;
                if (files.length === 0) {
                    carouselInner.innerHTML = '<div class="carousel-item active"><img class="object-fit-cover w-100 d-block" src="https://cdn.bootstrapstudio.io/placeholders/1400x800.png" alt="Slide Image" width="433" height="500"></div>';
                    carouselIndicators.innerHTML = '<button type="button" data-bs-target="#carousel-1" data-bs-slide-to="0" class="active"></button>';
                    return;
                }

                Array.from(files).forEach(function(file, index) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var activeClass = index === 0 ? " active" : "";

                        var itemDiv = document.createElement("div");
                        itemDiv.className = "carousel-item" + activeClass;
                        var img = document.createElement("img");
                        img.className = "object-fit-cover w-100 d-block";
                        img.src = e.target.result;
                        img.alt = "Slide Image";
                        img.width = 433;
                        img.height = 500;
                        itemDiv.appendChild(img);
                        carouselInner.appendChild(itemDiv);

                        var indicatorBtn = document.createElement("button");
                        indicatorBtn.type = "button";
                        indicatorBtn.setAttribute("data-bs-target", "#carousel-1");
                        indicatorBtn.setAttribute("data-bs-slide-to", index);
                        if (index === 0) indicatorBtn.className = "active";
                        carouselIndicators.appendChild(indicatorBtn);
                    };
                    reader.readAsDataURL(file);
                });
            });
        }
    });

    document.querySelectorAll('.visualizar-produto').forEach(function(button) {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            let row = e.target.closest('tr');
            let productId = row.querySelector('td').textContent.trim();

            fetch('/products/' + productId)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao buscar os dados do produto');
                    }
                    return response.json();
                })
                .then(product => {
                    document.getElementById('produto-nome').textContent = product.name;
                    document.getElementById('produto-preco').textContent = product.price;
                    document.getElementById('produto-quantidade').textContent = product.stockQuantity;
                    document.getElementById('produto-descricao').textContent = product.description;

                    // Função para gerar estrelas de acordo com a avaliação
                    function generateStarRating(rating) {
                        let stars = "";
                        for (let i = 1; i <= 5; i++) {
                            if (i <= rating) {
                                stars += '<i class="fas fa-star text-warning"></i>'; // Estrela cheia
                            } else {
                                stars += '<i class="far fa-star text-warning"></i>'; // Estrela vazia
                            }
                        }
                        return stars;
                    }

                    document.getElementById('produto-avaliacao').innerHTML = generateStarRating(product.rating);

                    let carouselInner = document.querySelector('#carousel-2 .carousel-inner');
                    let carouselIndicators = document.querySelector('#carousel-2 .carousel-indicators');
                    carouselInner.innerHTML = "";
                    carouselIndicators.innerHTML = "";

                    if (product.images && product.images.length > 0) {
                        product.images.forEach(function(img, index) {
                            let activeClass = index === 0 ? " active" : "";

                            let itemDiv = document.createElement("div");
                            itemDiv.className = "carousel-item" + activeClass;

                            let image = document.createElement("img");
                            image.className = "w-100 d-block";
                            image.src = "data:image/jpeg;base64," + img.base64Image;
                            image.alt = "Imagem do produto";

                            itemDiv.appendChild(image);
                            carouselInner.appendChild(itemDiv);

                            let indicatorBtn = document.createElement("button");
                            indicatorBtn.type = "button";
                            indicatorBtn.setAttribute("data-bs-target", "#carousel-2");
                            indicatorBtn.setAttribute("data-bs-slide-to", index);
                            if (index === 0) indicatorBtn.className = "active";
                            carouselIndicators.appendChild(indicatorBtn);
                        });
                    } else {
                        carouselInner.innerHTML = '<div class="carousel-item active"><img class="w-100 d-block" src="https://cdn.bootstrapstudio.io/placeholders/1400x800.png" alt="Slide Image"></div>';
                        carouselIndicators.innerHTML = '<button type="button" data-bs-target="#carousel-2" data-bs-slide-to="0" class="active"></button>';
                    }

                    let modal = new bootstrap.Modal(document.getElementById('modal-mostrar-produto'));
                    modal.show();
                })
                .catch(error => {
                    console.error('Erro:', error);
                });
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Adiciona o evento de clique ao botão "Alterar"
        document.querySelectorAll('.alterar-produto').forEach(function (button) {
            button.addEventListener('click', function (e) {
                e.preventDefault();

                let row = e.target.closest('tr'); // Pega a linha correspondente
                let productId = row.querySelector('td').textContent.trim(); // Obtém o ID do produto

                fetch('/products/' + productId) // Faz a requisição para obter os detalhes
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Erro ao buscar os dados do produto');
                        }
                        return response.json();
                    })
                    .then(product => {
                        // Preenche os campos do modal com os dados do produto
                        document.getElementById('nome-produto').value = product.name;
                        document.getElementById('preco-produto').value = product.price;
                        document.getElementById('quantidade-produto').value = product.stockQuantity;
                        document.getElementById('descricao-produto').value = product.description;
                        document.getElementById('avaliacao-produto').value = product.rating;

                        // Armazena o ID do produto para a edição
                        document.getElementById('modal-cadastrar-produto').dataset.productId = product.id;

                        // Atualiza o carrossel de imagens
                        let carouselInner = document.querySelector("#carousel-1 .carousel-inner");
                        let carouselIndicators = document.querySelector("#carousel-1 .carousel-indicators");

                        carouselInner.innerHTML = "";
                        carouselIndicators.innerHTML = "";

                        if (product.images && product.images.length > 0) {
                            product.images.forEach(function (img, index) {
                                let activeClass = index === 0 ? " active" : "";

                                let itemDiv = document.createElement("div");
                                itemDiv.className = "carousel-item" + activeClass;

                                let image = document.createElement("img");
                                image.className = "object-fit-cover w-100 d-block";
                                image.src = "data:image/jpeg;base64," + img.base64Image;
                                image.alt = "Imagem do produto";
                                image.width = 433;
                                image.height = 500;

                                itemDiv.appendChild(image);
                                carouselInner.appendChild(itemDiv);

                                let indicatorBtn = document.createElement("button");
                                indicatorBtn.type = "button";
                                indicatorBtn.setAttribute("data-bs-target", "#carousel-1");
                                indicatorBtn.setAttribute("data-bs-slide-to", index);
                                if (index === 0) indicatorBtn.className = "active";
                                carouselIndicators.appendChild(indicatorBtn);
                            });
                        } else {
                            carouselInner.innerHTML = '<div class="carousel-item active"><img class="object-fit-cover w-100 d-block" src="https://cdn.bootstrapstudio.io/placeholders/1400x800.png" alt="Slide Image" width="433" height="500"></div>';
                            carouselIndicators.innerHTML = '<button type="button" data-bs-target="#carousel-1" data-bs-slide-to="0" class="active"></button>';
                        }

                        // Abre o modal de edição
                        let modal = new bootstrap.Modal(document.getElementById('modal-cadastrar-produto'));
                        modal.show();
                    })
                    .catch(error => {
                        console.error('Erro:', error);
                    });
            });
        });

        // Manipula o envio do formulário para atualizar o produto
        document.querySelector("#modal-cadastrar-produto form").addEventListener("submit", function (e) {
            e.preventDefault(); // Evita o envio padrão do formulário

            let form = e.target;
            let productId = document.getElementById('modal-cadastrar-produto').dataset.productId;
            let formData = new FormData(form);

            let url = productId ? `/products/${productId}` : "/products"; // Define a URL dinamicamente
            let method = productId ? "PUT" : "POST"; // Define o método HTTP dinamicamente

            fetch(url, {
                method: method,
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao salvar o produto');
                    }
                    return response.text();
                })
                .then(() => {
                    location.reload(); // Recarrega a página para atualizar os dados na tabela
                })
                .catch(error => {
                    console.error('Erro:', error);
                });
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let table = document.querySelector("#dataTable tbody");
        let rows = table.querySelectorAll("tr");
        let rowsPerPage = 10;
        let currentPage = 1;
        let totalPages = Math.ceil(rows.length / rowsPerPage);

        function showPage(page) {
            let start = (page - 1) * rowsPerPage;
            let end = start + rowsPerPage;

            rows.forEach((row, index) => {
                row.style.display = (index >= start && index < end) ? "" : "none";
            });

            document.querySelectorAll(".pagination .page-item").forEach(item => {
                item.classList.remove("active");
                let link = item.querySelector(".page-link");
                if (link) {
                    link.classList.remove("bg-primary", "text-white"); // Remove a cor dos outros
                }
            });

            let activePage = document.querySelector(`.pagination .page-item[data-page="${page}"]`);
            if (activePage) {
                activePage.classList.add("active");
                let activeLink = activePage.querySelector(".page-link");
                if (activeLink) {
                    activeLink.classList.add("bg-primary", "text-white"); // Aplica a cor primária apenas no ativo
                }
            }
        }

        function createPagination() {
            let pagination = document.querySelector(".pagination");
            pagination.innerHTML = '';

            let prev = document.createElement("li");
            prev.className = "page-item";
            prev.innerHTML = `<a class="page-link" href="#">«</a>`;
            prev.addEventListener("click", () => {
                if (currentPage > 1) {
                    currentPage--;
                    showPage(currentPage);
                }
            });
            pagination.appendChild(prev);

            for (let i = 1; i <= totalPages; i++) {
                let li = document.createElement("li");
                li.className = "page-item";
                li.setAttribute("data-page", i);
                li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
                li.addEventListener("click", () => {
                    currentPage = i;
                    showPage(currentPage);
                });
                pagination.appendChild(li);
            }

            let next = document.createElement("li");
            next.className = "page-item";
            next.innerHTML = `<a class="page-link" href="#">»</a>`;
            next.addEventListener("click", () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    showPage(currentPage);
                }
            });
            pagination.appendChild(next);

            showPage(1);
        }

        if (rows.length > 0) {
            createPagination();
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".toggle-status").forEach(button => {
            button.addEventListener("click", function (event) {
                event.preventDefault();
                let productId = this.getAttribute("data-id");

                let confirmModal = new bootstrap.Modal(document.getElementById('modal-confirma'));
                let confirmButton = document.querySelector("#modal-confirma .btn-primary");

                confirmButton.onclick = function () {
                    fetch(`/products/${productId}/toggle-status`, {
                        method: "PUT"
                    })
                        .then(response => response.text())
                        .then(() => {
                            // Atualiza o status na interface sem recarregar
                            let statusCell = document.querySelector(`tr[data-id="${productId}"] .status-cell`);
                            if (statusCell) {
                                statusCell.textContent = (statusCell.textContent.trim() === "Habilitado") ? "Desabilitado" : "Habilitado";
                            }
                        })
                        .catch(error => console.error("Erro:", error));

                    confirmModal.hide();
                };

                confirmModal.show();
            });
        });
    });
</script>






</body>
</html>
